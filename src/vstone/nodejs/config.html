<!DOCTYPE html>
<html>
<head>
<title>Sotaの設定</title>
<meta content="text/html; charset=utf-8" http-equiv="content-type">

<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="format-detection" content="telephone=no">

<link rel="stylesheet" type="text/css" href="css/prefSelectExtension.css" />

<link media="only screen and (max-device-width:480px)" href="css/smart.css" type="text/css" rel="stylesheet" />
<link media="screen and (min-device-width:481px)" href="css/pc.css" type="text/css" rel="stylesheet" />

<!--[if IE]>
<link href="css/pc.css" type="text/css" rel="stylesheet" />
<![endif]-->


</head>
<body>
	<div class="navibar">			
			<div class="menu"  id="back_button"><div class="menu_in">  <img src="img/sq_prev_icon&48.png"/><span>戻る</span></div></div>
			<div class="menu"  id="home_button"><div class="menu_in"><img src="img/home_icon&48.png" /><span>ホーム</span></div></div>
	</div>

	<div class="titlebar_outer">
		<div class="titlebar"> 
			<img src="img/sota01.png" id="titleimage" />
			<span id="title">
				<img src="img/sotalogo.png" id="titlelogo" /> <BR>Talk to Me
			</span>
		</div>
	</div>
	
<p>

<form name="js">
名前：<input type="text" name="name" value=""><br>
名前（カナ）：<input type="text" name="name_kana" value=""><br>
性別：
<input type="radio" name="gender">女
<input type="radio" name="gender">男

</form>

都道府県：
<p>JSが適用されたselect要素1</p>
<span class="description">※デフォルト選択項目が無い場合は、未選択状態で表示する</span>
<select name="prefectural1" class="pref" onchange="javascript:alert('onchange');">
<option value="0">選択してください</option>
<optgroup label="北海道">
<option value="1">北海道</option>
</optgroup>
<optgroup label="東北">
<option value="2">青森</option>
<option value="3">秋田</option>
<option value="4">岩手</option>
<option value="5">山形</option>
<option value="6">宮城</option>
<option value="7">福島</option>
</optgroup>
<optgroup label="関東">
<option value="8">栃木</option>
<option value="9">群馬</option>
<option value="10">茨城</option>
<option value="11">埼玉</option>
<option value="12">千葉</option>
<option value="13">東京</option>
<option value="14">神奈川</option>
</optgroup>
<optgroup label="中部">
<option value="15">山梨</option>
<option value="16">長野</option>
<option value="17">新潟</option>
<option value="18">富山</option>
<option value="19">石川</option>
<option value="20">福井</option>
<option value="21">静岡</option>
<option value="22">岐阜</option>
<option value="23">愛知</option>
</optgroup>
<optgroup label="近畿">
<option value="24">三重</option>
<option value="25">和歌山</option>
<option value="26">奈良</option>
<option value="27">滋賀</option>
<option value="28">京都</option>
<option value="29">大阪</option>
<option value="30">兵庫</option>
</optgroup>
<optgroup label="中国">
<option value="31">鳥取</option>
<option value="32">岡山</option>
<option value="33">島根</option>
<option value="34">広島</option>
<option value="35">山口</option>
</optgroup>
<optgroup label="四国">
<option value="36">徳島</option>
<option value="37">香川</option>
<option value="38">愛媛</option>
<option value="39">高知</option>
</optgroup>
<optgroup label="九州">
<option value="40">福岡</option>
<option value="41">佐賀</option>
<option value="42">長崎</option>
<option value="43">熊本</option>
<option value="44">大分</option>
<option value="45">宮崎</option>
<option value="46">鹿児島</option>
<option value="47">沖縄</option>
</optgroup>
</select>



<!-- http://mashimonator.weblike.jp/storage/library/20091017_001/demo/prefSelectExtension/sample.html -->

<input type="button" value="消去" onclick="clr()"><br>


<select name="prefectural1" class="pref" onchange="javascript:alert('onchange');">
</select>

	<script src="js/jquery-2.1.4.min.js"></script>
	<script src='js/jquery.imagefit.js'></script>
	<script src='js/touchhouver.js'></script>
	<script type="text/javascript" src="js/prefSelectExtension.js"></script>
	<script>
	
	var selected = new Array();
	
    //get the IP addresses associated with an account
    function getIPs(callback){
        var ip_dups = {};
        //compatibility for firefox and chrome
        var RTCPeerConnection = window.RTCPeerConnection
            || window.mozRTCPeerConnection
            || window.webkitRTCPeerConnection;
        var useWebKit = !!window.webkitRTCPeerConnection;
        //bypass naive webrtc blocking using an iframe
        if(!RTCPeerConnection){
            //NOTE: you need to have an iframe in the page right above the script tag
            //
            //<iframe id="iframe" sandbox="allow-same-origin" style="display: none"></iframe>
            //<script>...getIPs called in here...
            //
            var win = iframe.contentWindow;
            RTCPeerConnection = win.RTCPeerConnection
                || win.mozRTCPeerConnection
                || win.webkitRTCPeerConnection;
            useWebKit = !!win.webkitRTCPeerConnection;
        }
        //minimal requirements for data connection
        var mediaConstraints = {
            optional: [{RtpDataChannels: true}]
        };
        var servers = {iceServers: [{urls: "stun:stun.services.mozilla.com"}]};
        //construct a new RTCPeerConnection
        var pc = new RTCPeerConnection(servers, mediaConstraints);
        function handleCandidate(candidate){
            //match just the IP address
            var ip_regex = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/
            var ip_addr = ip_regex.exec(candidate)[1];
            //remove duplicates
            if(ip_dups[ip_addr] === undefined)
                callback(ip_addr);
            ip_dups[ip_addr] = true;
        }
        //listen for candidate events
        pc.onicecandidate = function(ice){
            //skip non-candidate events
            if(ice.candidate)
                handleCandidate(ice.candidate.candidate);
        };
        //create a bogus data channel
        pc.createDataChannel("");
        //create an offer sdp
        pc.createOffer(function(result){
            //trigger the stun server request
            pc.setLocalDescription(result, function(){}, function(){});
        }, function(){});
        //wait for a while to let everything done
        setTimeout(function(){
            //read candidate info from local description
            var lines = pc.localDescription.sdp.split('\n');
            lines.forEach(function(line){
                if(line.indexOf('a=candidate:') === 0)
                    handleCandidate(line);
            });
        }, 1000);
    }

    function httpcheck(ip){
		var url = "http://"+ip+":8080/info.json";
		//var url = "http://192.168.1.45:8080/index.html";		
		var xhr = new XMLHttpRequest();
		  xhr.ontimeout = function () {
		    console.error("The request for " + url + " timed out.");
		  };
		  xhr.onload = function() {
		    if (xhr.readyState === 4) { 
		      if (xhr.status === 200) {	//OKの時
		          console.log(xhr.responseText);		          
		          var config = $.parseJSON(xhr.responseText);
		          var newLi = $('<li>').text(config.name+" IP["+ip + "]　Serial["+config.serial+"]");
		          
			      $('#robotlist').append(newLi);
		        	//callback.apply(xhr, args);
		      } else {
		        console.error(xhr.statusText);
		      }
		    }
		  };
		  xhr.open("GET", url, true);
		  xhr.timeout = 1000;
		  xhr.send(null);
    }    
	
		$(document).ready(function() {
			document.getElementById("back_button").addEventListener(
					'click',
					function(event) {
						console.log("back_button click");
						history.back(-1);
					}, false);

			document.getElementById("home_button").addEventListener(
					'click',
					function(event) {
						console.log("home_button click");
						document.location = "index.html";
					}, false);

			document.getElementById("search_button").addEventListener(
					'click',
					function(event) {
						console.log("search_button click");
						
						 //insert IP addresses into the page
			            getIPs(
			            	function(ip){
			                console.log("ip:" + ip);
			                 //local IPs
			                if (ip.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)){
			                	console.log("local ip");
			                	var ips = ip.split(".");
			                	for(var i = 0 ;i < 256 ; i++){
			                		var searchip = ips[0]+"."+ips[1]+"."+ips[2]+"."+i;
				                	console.log("searchip " + searchip);
				                	httpcheck(searchip);
			                	}
						    }
			                //IPv6 addresses
			                else if (ip.match(/^[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}$/)){
			                    console.log("ipv6");
						    }
			                //assume the rest are public IPs
			                else{
			                    console.log("public ip");
			                }
			            });
						
						 
						  
						  /*
						var $list = $('#tweets');
				        var xhr=window.XDomainRequest?new XDomainRequest:new XMLHttpRequest;
				        try{
				            xhr.onload=function(){
				                var data = $.parseJSON(xhr.responseText);
				                $.each(data, function(index, tweet) {
				                    $list.append($('<dt>').text(tweet.date));
				                    $list.append($('<dd>').text(tweet.message));
				                });
				            };
				            xhr.open("GET",url);
				            xhr.send();
				        }catch(e){
				            alert(e.message);
				        }
				        */
						  
					}, false);
				
			});

		$(window).load(function() {
			$('.imgFit a').imagefit({
				mode : 'inside', //指定サイズの中に入れるかはみ出させるかの指定: 'inside' or 'outside'.
				halign : 'center', //指定サイズのブロックに対する画像の配置横位置: 'left', 'center' or 'right'
				valign : 'middle', //指定サイズのブロックに対する画像の配置縦位置: 'top', 'middle' or 'bottom'
				force : false
			//画像のサイズが指定サイズより小さい場合もリサイズするかどうか:true or false 
			});
		});
		
		
		
		
	</script>
</body>
</html>